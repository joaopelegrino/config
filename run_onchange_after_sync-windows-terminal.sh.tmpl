#!/bin/bash
# Windows Terminal Sync Script
# Syncs settings.json from chezmoi to Windows Terminal
# Runs every time settings.json template changes
# Hash: {{ include "dot_config/windows-terminal/settings.json.tmpl" | sha256sum }}

{{- if eq .chezmoi.os "linux" }}
{{- if (.chezmoi.kernel.osrelease | lower | contains "microsoft") }}

set -e

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Paths
WINDOWS_USER="{{ .windows_username }}"
WT_PATH="/mnt/c/Users/${WINDOWS_USER}/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState"
CHEZMOI_WT_CONFIG="{{ .chezmoi.homeDir }}/.config/windows-terminal/settings.json"

# Check if Windows Terminal exists
if [ ! -d "$WT_PATH" ]; then
    exit 0  # Silent exit if no Windows Terminal
fi

# Check if source file exists
if [ ! -f "$CHEZMOI_WT_CONFIG" ]; then
    exit 0  # Silent exit if source doesn't exist yet
fi

echo -e "${YELLOW}üîÑ Syncing Windows Terminal settings...${NC}"

# Copy file
cp "$CHEZMOI_WT_CONFIG" "$WT_PATH/settings.json"

if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Windows Terminal settings synced!"
else
    echo "‚ö†Ô∏è  Failed to sync settings"
    exit 1
fi

{{- end }}
{{- end }}
