# Proposta: Integrar Windows Terminal no Chezmoi

**Data:** 2025-10-22
**Status:** Proposta para Implementa√ß√£o
**Prioridade:** Alta (Antes da Limpeza Geral)

---

## üéØ Objetivo

Gerenciar as configura√ß√µes do Windows Terminal atrav√©s do chezmoi, permitindo:
- ‚úÖ Versionamento das configura√ß√µes
- ‚úÖ Sincroniza√ß√£o entre m√°quinas
- ‚úÖ Backup autom√°tico
- ‚úÖ Aplica√ß√£o consistente via `chezmoi apply`

---

## üìç Localiza√ß√£o Atual

### No Windows
```
C:\Users\valor\AppData\Local\Packages\Microsoft.WindowsTerminal_8wekyb3d8bbwe\LocalState\settings.json
```

### No WSL (equivalente)
```
/mnt/c/Users/valor/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json
```

### No Reposit√≥rio Chezmoi (atual)
```
/home/notebook/.local/share/chezmoi/windows-terminal-settings.json
```
- **Status:** ‚ùå Arquivo existe mas **N√ÉO est√° gerenciado** pelo chezmoi
- **Problema:** N√£o √© aplicado automaticamente com `chezmoi apply`

---

## üèóÔ∏è Proposta de Implementa√ß√£o

### Op√ß√£o 1: Symlink via Script (RECOMENDADA) ‚≠ê

**Vantagens:**
- ‚úÖ Funciona perfeitamente com WSL2
- ‚úÖ Mant√©m arquivo Windows sincronizado automaticamente
- ‚úÖ Suporta templating do chezmoi
- ‚úÖ Permite vari√°veis din√¢micas (username, paths)

**Estrutura:**
```
~/.local/share/chezmoi/
‚îú‚îÄ‚îÄ dot_config/
‚îÇ   ‚îî‚îÄ‚îÄ windows-terminal/
‚îÇ       ‚îî‚îÄ‚îÄ settings.json.tmpl     # Template com vari√°veis
‚îî‚îÄ‚îÄ run_once_before_setup-windows-terminal.sh.tmpl  # Script de setup
```

**Implementa√ß√£o:**

#### 1. Criar arquivo template
**Arquivo:** `dot_config/windows-terminal/settings.json.tmpl`
```json
{{- /* Windows Terminal Settings Template */ -}}
{{- /* User: {{ .chezmoi.username }} */ -}}
{{- /* OS: {{ .chezmoi.os }} */ -}}
{
    "$help": "https://aka.ms/terminal-documentation",
    "$schema": "https://aka.ms/terminal-profiles-schema",

    {{- /* Configura√ß√µes gerais */ -}}
    "defaultProfile": "{51855cb2-8cce-5362-8f54-464b92b32386}",
    "copyOnSelect": true,
    "copyFormatting": "none",
    "centerOnLaunch": true,

    {{- /* ... resto das configura√ß√µes ... */ -}}
}
```

#### 2. Criar script de setup
**Arquivo:** `run_once_before_setup-windows-terminal.sh.tmpl`
```bash
#!/bin/bash
# Setup Windows Terminal settings via chezmoi

{{- if eq .chezmoi.os "linux" }}
{{- if (.chezmoi.kernel.osrelease | lower | contains "microsoft") }}

echo "üîß Setting up Windows Terminal integration..."

# Definir caminhos
WINDOWS_USER="{{ .windows_username }}"
WT_PATH="/mnt/c/Users/${WINDOWS_USER}/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState"
CHEZMOI_WT_CONFIG="{{ .chezmoi.homeDir }}/.config/windows-terminal/settings.json"

# Verificar se Windows Terminal est√° instalado
if [ ! -d "$WT_PATH" ]; then
    echo "‚ö†Ô∏è  Windows Terminal n√£o encontrado em: $WT_PATH"
    echo "   Ignorando setup..."
    exit 0
fi

# Fazer backup do settings.json atual
if [ -f "$WT_PATH/settings.json" ]; then
    BACKUP_FILE="$WT_PATH/settings.json.backup.$(date +%Y%m%d_%H%M%S)"
    echo "üì¶ Criando backup: $BACKUP_FILE"
    cp "$WT_PATH/settings.json" "$BACKUP_FILE"
fi

# Criar symlink do chezmoi para Windows Terminal
echo "üîó Criando symlink..."
ln -sf "$CHEZMOI_WT_CONFIG" "$WT_PATH/settings.json"

echo "‚úÖ Windows Terminal configurado!"
echo "   Configura√ß√µes gerenciadas por: $CHEZMOI_WT_CONFIG"
echo "   Aplicadas em: $WT_PATH/settings.json"

{{- else }}
echo "‚ö†Ô∏è  N√£o detectado WSL2, ignorando setup Windows Terminal"
{{- end }}
{{- else }}
echo "‚ö†Ô∏è  OS n√£o √© Linux, ignorando setup Windows Terminal"
{{- end }}
```

#### 3. Adicionar vari√°vel ao chezmoi.toml
**Arquivo:** `.chezmoi.toml.tmpl`
```toml
{{- $windows_username := "valor" -}}
{{- if hasKey . "windows_username" -}}
{{-   $windows_username = .windows_username -}}
{{- else if stdinIsATTY -}}
{{-   $windows_username = promptString "Windows username" $windows_username -}}
{{- end -}}

[data]
    windows_username = {{ $windows_username | quote }}
```

---

### Op√ß√£o 2: Copy Manual (Menos Recomendada)

**Estrutura:**
```
~/.local/share/chezmoi/
‚îî‚îÄ‚îÄ private_AppData/
    ‚îî‚îÄ‚îÄ Local/
        ‚îî‚îÄ‚îÄ Packages/
            ‚îî‚îÄ‚îÄ Microsoft.WindowsTerminal_8wekyb3d8bbwe/
                ‚îî‚îÄ‚îÄ LocalState/
                    ‚îî‚îÄ‚îÄ settings.json.tmpl
```

**Problemas:**
- ‚ùå Chezmoi n√£o gerencia naturalmente caminhos Windows do WSL
- ‚ùå Requer modifica√ß√£o de `modify_` scripts
- ‚ùå Mais complexo de manter

---

## üìã Plano de Implementa√ß√£o Passo-a-Passo

### Etapa 1: Backup e Prepara√ß√£o
```bash
cd /home/notebook/.local/share/chezmoi

# 1. Fazer backup do settings atual do Windows Terminal
powershell.exe -Command "Copy-Item \$env:LOCALAPPDATA\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json \$env:LOCALAPPDATA\\Packages\\Microsoft.WindowsTerminal_8wekyb3d8bbwe\\LocalState\\settings.json.backup.$(date +%Y%m%d)"

# 2. Copiar settings atual para estrutura chezmoi
mkdir -p dot_config/windows-terminal
cp windows-terminal-settings.json dot_config/windows-terminal/settings.json.tmpl
```

### Etapa 2: Criar Template com Vari√°veis

Editar `dot_config/windows-terminal/settings.json.tmpl` e adicionar vari√°veis din√¢micas:

```json
{
    "defaultProfile": "{{ .wsl_profile_guid }}",
    "profiles": {
        "defaults": {
            "font": {
                "face": "MesloLGS NF",
                "size": 11
            }
        },
        "list": [
            {
                "guid": "{{ .wsl_profile_guid }}",
                "name": "Ubuntu-24.04 ({{ .chezmoi.username }})",
                "source": "Windows.Terminal.Wsl",
                "startingDirectory": "//wsl.localhost/Ubuntu-24.04/home/{{ .chezmoi.username }}"
            }
        ]
    }
}
```

### Etapa 3: Criar Script de Setup

Criar `run_once_before_setup-windows-terminal.sh.tmpl` com o conte√∫do mostrado na Op√ß√£o 1.

### Etapa 4: Atualizar .chezmoi.toml.tmpl

Adicionar prompts para vari√°veis Windows Terminal:

```toml
{{- $windows_username := "valor" -}}
{{- $wsl_profile_guid := "{51855cb2-8cce-5362-8f54-464b92b32386}" -}}

{{- if stdinIsATTY -}}
{{-   $windows_username = promptString "Windows username" $windows_username -}}
{{-   $wsl_profile_guid = promptString "WSL Profile GUID" $wsl_profile_guid -}}
{{- end -}}

[data]
    windows_username = {{ $windows_username | quote }}
    wsl_profile_guid = {{ $wsl_profile_guid | quote }}
```

### Etapa 5: Testar Aplica√ß√£o

```bash
# 1. Re-init chezmoi (responder prompts)
chezmoi init

# 2. Ver o que ser√° aplicado (dry-run)
chezmoi apply --dry-run --verbose

# 3. Aplicar mudan√ßas
chezmoi apply

# 4. Verificar symlink
ls -la /mnt/c/Users/valor/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json
```

### Etapa 6: Remover Arquivo Legado

```bash
# Ap√≥s confirmar que tudo funciona
cd /home/notebook/.local/share/chezmoi
rm windows-terminal-settings.json

# Adicionar ao .chezmoiignore se necess√°rio
echo "windows-terminal-settings.json" >> .chezmoiignore
```

---

## üé® Funcionalidades Avan√ßadas

### 1. Profiles Din√¢micos por M√°quina

Usar templates para diferentes m√°quinas:

```json
{{- if eq .chezmoi.hostname "laptop-trabalho" }}
{
    "profiles": {
        "list": [
            {
                "name": "Work WSL",
                "colorScheme": "One Half Dark"
            }
        ]
    }
}
{{- else }}
{
    "profiles": {
        "list": [
            {
                "name": "Personal WSL",
                "colorScheme": "Campbell"
            }
        ]
    }
}
{{- end }}
```

### 2. Temas por Ambiente

```json
{
    "schemes": [
        {{- if .is_work_machine }}
        {
            "name": "Work Theme",
            "background": "#1E1E1E",
            "foreground": "#D4D4D4"
        }
        {{- else }}
        {
            "name": "Personal Theme",
            "background": "#0C0C0C",
            "foreground": "#CCCCCC"
        }
        {{- end }}
    ]
}
```

### 3. Script de Atualiza√ß√£o Manual

Criar `scripts/update-windows-terminal.sh`:
```bash
#!/bin/bash
# Atualiza settings do Windows Terminal for√ßadamente

CHEZMOI_WT="{{ .chezmoi.homeDir }}/.config/windows-terminal/settings.json"
WT_PATH="/mnt/c/Users/{{ .windows_username }}/AppData/Local/Packages/Microsoft.WindowsTerminal_8wekyb3d8bbwe/LocalState/settings.json"

echo "üîÑ Atualizando Windows Terminal settings..."
cp "$CHEZMOI_WT" "$WT_PATH"
echo "‚úÖ Atualizado!"
```

---

## üîí Considera√ß√µes de Seguran√ßa

### Informa√ß√µes Sens√≠veis

**N√£o incluir no template:**
- Paths absolutos com usernames pessoais (usar vari√°veis)
- Credenciais ou tokens
- Informa√ß√µes de rede corporativa

**Usar `.chezmoiignore` para:**
```
# Arquivos tempor√°rios Windows Terminal
**/*.backup.*
**/settings.json.old
```

---

## üìä Compara√ß√£o: Antes vs Depois

### ‚ùå Antes (Situa√ß√£o Atual)
```
Arquivo: windows-terminal-settings.json
Localiza√ß√£o: Raiz do chezmoi
Status: N√£o gerenciado
Aplica√ß√£o: Manual (copiar/colar)
Versionamento: Sim (mas n√£o aplicado)
Templating: N√£o
Backup: Manual
```

### ‚úÖ Depois (Com Integra√ß√£o)
```
Arquivo: dot_config/windows-terminal/settings.json.tmpl
Localiza√ß√£o: Estrutura organizada
Status: Gerenciado pelo chezmoi
Aplica√ß√£o: Autom√°tica (chezmoi apply)
Versionamento: Sim (com hist√≥rico)
Templating: Sim (vari√°veis din√¢micas)
Backup: Autom√°tico (script)
```

---

## üéØ Benef√≠cios da Integra√ß√£o

1. **Consist√™ncia:** Mesmas configura√ß√µes em todas as m√°quinas
2. **Versionamento:** Hist√≥rico completo de mudan√ßas
3. **Automa√ß√£o:** `chezmoi apply` aplica tudo
4. **Templating:** Vari√°veis para diferentes ambientes
5. **Backup:** Backups autom√°ticos antes de aplicar
6. **Documenta√ß√£o:** Settings explicados com coment√°rios
7. **Seguran√ßa:** Vari√°veis sens√≠veis separadas

---

## üìù Pr√≥ximos Passos Recomendados

### Fase 1: Setup Inicial (30min)
1. ‚úÖ Backup atual do Windows Terminal
2. ‚úÖ Criar estrutura `dot_config/windows-terminal/`
3. ‚úÖ Mover e converter para template
4. ‚úÖ Criar script `run_once_before_setup-windows-terminal.sh.tmpl`

### Fase 2: Configura√ß√£o (15min)
5. ‚úÖ Adicionar vari√°veis ao `.chezmoi.toml.tmpl`
6. ‚úÖ Testar com `chezmoi apply --dry-run`
7. ‚úÖ Aplicar e verificar

### Fase 3: Limpeza (5min)
8. ‚úÖ Remover `windows-terminal-settings.json` da raiz
9. ‚úÖ Atualizar documenta√ß√£o
10. ‚úÖ Commit das mudan√ßas

### Fase 4: Documenta√ß√£o (10min)
11. ‚úÖ Atualizar README.md com instru√ß√µes Windows Terminal
12. ‚úÖ Adicionar se√ß√£o no CLAUDE.md
13. ‚úÖ Criar exemplo de customiza√ß√£o

---

## üöÄ Comando R√°pido de Implementa√ß√£o

```bash
# Executar tudo de uma vez (ap√≥s revisar)
cd /home/notebook/.local/share/chezmoi

# 1. Criar estrutura
mkdir -p dot_config/windows-terminal

# 2. Mover arquivo
mv windows-terminal-settings.json dot_config/windows-terminal/settings.json.tmpl

# 3. Criar script de setup (criar arquivo manualmente ou via cat)
cat > run_once_before_setup-windows-terminal.sh.tmpl << 'EOFSCRIPT'
#!/bin/bash
# [Conte√∫do do script da Op√ß√£o 1]
EOFSCRIPT

chmod +x run_once_before_setup-windows-terminal.sh.tmpl

# 4. Testar
chezmoi apply --dry-run --verbose
```

---

## ‚ùì FAQ

### P: O symlink funciona com Windows Terminal?
**R:** Sim! Windows Terminal no Windows pode seguir symlinks criados pelo WSL.

### P: E se eu quiser settings diferentes por m√°quina?
**R:** Use templates com condicionais baseados em `{{ .chezmoi.hostname }}` ou crie vari√°veis espec√≠ficas.

### P: Posso ter backup do settings anterior?
**R:** Sim! O script cria backup autom√°tico com timestamp antes de aplicar.

### P: Como reverter se algo der errado?
**R:** Restaure do backup: `cp settings.json.backup.* settings.json`

### P: Funciona com Windows Terminal Preview?
**R:** Sim, basta ajustar o path para `Microsoft.WindowsTerminalPreview_8wekyb3d8bbwe`

---

## üìö Refer√™ncias

- [Chezmoi Docs - Templates](https://www.chezmoi.io/user-guide/templating/)
- [Windows Terminal Docs](https://learn.microsoft.com/windows/terminal/)
- [Chezmoi + WSL Best Practices](https://www.chezmoi.io/user-guide/machines/windows/)

---

**Criado por:** Claude Code
**Baseado em:** An√°lise do ambiente WSL2 + Windows Terminal 1.19.10821.0
**Status:** Pronto para Implementa√ß√£o
